<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P√©tanque Tool</title>
<style>
    body {
        margin: 0;
        background-color: #121212;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
    }
    .page { display: none; padding: 15px; }
    .active { display: block; }
    button {
        background-color: #1e88e5;
        color: white;
        border: none;
        padding: 15px 20px;
        margin: 10px;
        font-size: 18px;
        border-radius: 10px;
        cursor: pointer;
        width: 80%;
        max-width: 300px;
    }
    button:active { background-color: #1565c0; }
    canvas { max-width: 100%; background: black; margin-top: 10px; }
    #photoInput { display: none; }
    .score { font-size: 28px; margin: 15px 0; }
</style>
</head>
<body>

<!-- Page Accueil -->
<div id="home" class="page active">
    <h1>Outil P√©tanque</h1>
    <button onclick="showPage('measure')">Mesurer les distances</button>
    <button onclick="showPage('score')">Compteur de points</button>
    <button onclick="showPage('help')">Aide</button>
</div>

<!-- Page Mesure -->
<div id="measure" class="page">
    <h2>Mesurer les distances</h2>
    <button onclick="document.getElementById('photoInput').click()">üì∑ Prendre une photo</button>
    <input type="file" id="photoInput" accept="image/*" capture="environment">
    <br>
    <canvas id="canvas"></canvas>
    <div id="distances"></div>
    <button onclick="resetMeasure()">üîÑ R√©initialiser</button>
    <button onclick="showPage('home')">‚¨Ö Retour</button>
</div>

<!-- Page Score -->
<div id="score" class="page">
    <h2>Compteur de points</h2>
    <div class="score">√âquipe A : <span id="scoreA">0</span></div>
    <div class="score">√âquipe B : <span id="scoreB">0</span></div>
    <button onclick="changeScore('A', 1)">+1 A</button>
    <button onclick="changeScore('A', -1)">-1 A</button>
    <button onclick="changeScore('B', 1)">+1 B</button>
    <button onclick="changeScore('B', -1)">-1 B</button>
    <button onclick="resetScore()">üîÑ R√©initialiser scores</button>
    <button onclick="showPage('home')">‚¨Ö Retour</button>
</div>

<!-- Page Aide -->
<div id="help" class="page">
    <h2>Aide</h2>
    <p>1Ô∏è‚É£ Prendre une photo du terrain.</p>
    <p>2Ô∏è‚É£ Cliquer sur le cochonnet (jaune).</p>
    <p>3Ô∏è‚É£ Cliquer sur chaque boule (rouge).</p>
    <p>Les distances seront calcul√©es automatiquement.</p>
    <button onclick="showPage('home')">‚¨Ö Retour</button>
</div>

<script>
let cochonnet = null;
let boules = [];
let image = new Image();

function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

document.getElementById('photoInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
        image.onload = function() {
            drawImage();
            cochonnet = null;
            boules = [];
            document.getElementById('distances').innerHTML = "";
        }
        image.src = event.target.result;
    }
    reader.readAsDataURL(file);
});

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.addEventListener('click', function(e) {
    if (!image.src) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * (canvas.width / rect.width);
    const y = (e.clientY - rect.top) * (canvas.height / rect.height);

    if (!cochonnet) {
        cochonnet = {x, y};
        drawImage();
    } else {
        boules.push({x, y});
        drawImage();
        updateDistances();
    }
});

function drawImage() {
    canvas.width = image.width;
    canvas.height = image.height;
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

    if (cochonnet) {
        ctx.beginPath();
        ctx.arc(cochonnet.x, cochonnet.y, 8, 0, Math.PI * 2);
        ctx.fillStyle = 'yellow';
        ctx.fill();
    }

    boules.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 8, 0, Math.PI * 2);
        ctx.fillStyle = 'red';
        ctx.fill();
    });
}

function updateDistances() {
    if (!cochonnet) return;
    let html = "<h3>Distances :</h3>";
    boules.forEach((b, i) => {
        const d = Math.sqrt(Math.pow(b.x - cochonnet.x, 2) + Math.pow(b.y - cochonnet.y, 2));
        html += `Boule ${i+1} : ${d.toFixed(1)} px<br>`;
    });
    document.getElementById('distances').innerHTML = html;
}

function resetMeasure() {
    cochonnet = null;
    boules = [];
    document.getElementById('distances').innerHTML = "";
    if (image.src) drawImage();
}

let scoreA = 0, scoreB = 0;
function changeScore(team, value) {
    if (team === 'A') scoreA = Math.max(0, scoreA + value);
    if (team === 'B') scoreB = Math.max(0, scoreB + value);
    document.getElementById('scoreA').innerText = scoreA;
    document.getElementById('scoreB').innerText = scoreB;
}
function resetScore() {
    scoreA = 0;
    scoreB = 0;
    document.getElementById('scoreA').innerText = scoreA;
    document.getElementById('scoreB').innerText = scoreB;
}
</script>

</body>
</html>
